!function(s,a,_){s(function(){s("#wpcontent #wpbody .wrap.woocommerce-bis-notifications").length&&(o=s('#adminmenu li.toplevel_page_woocommerce .wp-submenu li a[href*="bis_dashboard"]')).length&&o.parent().addClass("current"),s(".woocommerce-bis-notifications #delete-action").on("click",function(e){if(!a.confirm(wc_bis_admin_params.i18n_wc_delete_notification_warning))return e.preventDefault(),!1}),s("#bis-notifications-table #doaction").on("click",function(e){if("delete"===s("#bulk-action-selector-top").val()&&!a.confirm(wc_bis_admin_params.i18n_wc_bulk_delete_notifications_warning))return e.preventDefault(),!1}),s("#bis-notifications-table #doaction2").on("click",function(e){if("delete"===s("#bulk-action-selector-bottom").val()&&!a.confirm(wc_bis_admin_params.i18n_wc_bulk_delete_notifications_warning))return e.preventDefault(),!1}),s("#bis-notifications-table .column-id .row-actions .delete a").on("click",function(e){if(!a.confirm(wc_bis_admin_params.i18n_wc_delete_notification_warning))return e.preventDefault(),!1}),i.init();var e,t,o=s(".notification-data--create");o.length&&(e=o.find(".sw-select2-search--products"),t=o.find(".notification-data__product-data"),e.on("change",function(){var e=parseInt(s(this).val(),10);0<e&&(t.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s.ajax({type:"POST",url:wc_bis_admin_params.wc_ajax_url,data:{action:"wc_bis_new_notification_get_product_data_html",product_id:e,security:wc_bis_admin_params.new_notification_product_data_nonce},dataType:"json",success:function(e){e.result&&"success"===e.result&&t.html(e.html)},complete:function(){t.unblock()}}).fail(function(e){a.console.log(e)}))})),s("div#woocommerce-product-data").length,s("input#wc_bis_opt_in_required").change(function(){s(this).is(":checked")?s("table.form-table .opt_in_required").closest("tr").show():s("table.form-table .opt_in_required").closest("tr").hide()}).trigger("change"),s("input#wc_bis_account_required").change(function(){s(this).is(":checked")?(s("table.form-table .account_required_field").closest("tr").hide(),s("table.form-table .opt_in_required").closest("tr").hide()):(s("table.form-table .account_required_field").closest("tr").show(),s("input#wc_bis_opt_in_required").is(":checked")&&s("table.form-table .opt_in_required").closest("tr").show())}).trigger("change"),s("input#wc_bis_double_opt_in_required").change(function(){s(this).is(":checked")?s("table.form-table .double_opt_in_required").closest("tr").show():s("table.form-table .double_opt_in_required").closest("tr").hide()}).trigger("change"),s("input#wc_bis_show_product_registrations_count").change(function(){s(this).is(":checked")?s("table.form-table .product_registrations_text").closest("tr").show():s("table.form-table .product_registrations_text").closest("tr").hide()}).trigger("change"),s("input#wc_bis_loop_signup_prompt_status").change(function(){s(this).is(":checked")?s("table.form-table .loop_signup_prompt_text").closest("tr").show():s("table.form-table .loop_signup_prompt_text").closest("tr").hide()}).trigger("change")});function o(e){this.$form=e,this.is_exporting=!1,this.canceled=!1,this.processStep=this.processStep.bind(this),this.onSubmit=this.onSubmit.bind(this),this.$form.find(".woocommerce-exporter-progress").val(0),e.on("click",".woocommerce-exporter-button",this.onSubmit)}o.prototype.onSubmit=function(e){e.preventDefault();e=new Date,e="wc-bis-notifications-export-"+e.getDate()+"-"+(e.getMonth()+1)+"-"+e.getFullYear()+"-"+e.getTime()+".csv";this.$form.addClass("woocommerce-exporter__exporting"),this.$form.find(".woocommerce-exporter-button").prop("disabled",!0),this.$form.find(".woocommerce-exporter-progress").val(0),this.processStep(1,[],"",e)},o.prototype.cancel=function(e,t,o,i){this.is_exporting=!1,this.canceled=!0};var i={view:!(o.prototype.processStep=function(e,t,o,i){var n,r=s("#woocommerce-exporter-meta:checked").length?1:0,c=s("#woocommerce-exporter-filtered:checked").length?1:0;c&&(n={date:!(!(n=function(e){e=e.split("+").join(" ");var t,o={},i=/[?&]?([^=]+)=([^&]*)/g;for(;t=i.exec(e);)o[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return o}(_.location.search)).m||0==n.m)&&parseInt(n.m,10),customer:!!n.bis_customer_filter&&parseInt(n.bis_customer_filter,10),product:!!n.bis_product_filter&&parseInt(n.bis_product_filter,10),search:n.s||!1,status:n.status||!1}),s.ajax({type:"POST",url:wc_bis_admin_params.wc_ajax_url,data:{form:t,action:"woocommerce_bis_do_ajax_notifications_export",step:e,export_meta:r,export_filters:c,date_filter:!(!c||!n)&&n.date,customer_filter:!(!c||!n)&&n.customer,product_filter:!(!c||!n)&&n.product,status_filter:!(!c||!n)&&n.status,filename:i,security:wc_bis_admin_params.export_notifications_nonce},dataType:"json",success:function(e){if(e.success)if("done"===e.data.step)this.is_exporting=!1,a.location=e.data.url,this.$form.find(".woocommerce-exporter-progress").val(e.data.percentage),setTimeout(function(){this.$form.removeClass("woocommerce-exporter__exporting"),this.$form.find(".woocommerce-exporter-button").prop("disabled",!1),this.$form.find(".woocommerce-exporter-progress").val(0)}.bind(this),2e3);else{if(this.is_exporting=!0,this.$form.find(".woocommerce-exporter-button").prop("disabled",!0),this.$form.find(".woocommerce-exporter-progress").val(e.data.percentage),this.canceled)return this.canceled=!1,this.is_exporting=!1,void setTimeout(function(){this.$form.removeClass("woocommerce-exporter__exporting"),this.$form.find(".woocommerce-exporter-progress").val(0),this.$form.find(".woocommerce-exporter-button").prop("disabled",!1)}.bind(this),2e3);this.processStep(parseInt(e.data.step,10),[],"",i)}}.bind(this)}).fail(function(e){a.console.log(e)})}),export_form:!1,init:function(){s(".woocommerce-bis-notifications").on("click",".woocommerce-bis-exporter-button",this.open.bind(this))},open:function(e){e.preventDefault();e=s.WCBackboneModal.View.extend({closeButton:this.cancel_export.bind(this)});return this.view=new e({target:"wc-bis-export-notifications",string:{action:wc_bis_admin_params.i18n_export_modal_title}}),this.populate_form.call(this),!1},cancel_export:function(e){!1===this.export_form||this.export_form.canceled||this.export_form.cancel(),e.preventDefault(),s(_.body).trigger("wc_backbone_modal_before_remove",this.view._target),this.view.undelegateEvents(),s(_).off("focusin"),s(_.body).css({overflow:"auto"}),this.view.remove(),s(_.body).trigger("wc_backbone_modal_removed",this.view._target)},populate_form:function(){this.block(this.view.$el.find(".wc-backbone-modal-content"));var e={action:"wc_bis_modal_export_notifications_html",dataType:"json",security:wc_bis_admin_params.modal_export_notifications_nonce};s.post(wc_bis_admin_params.wc_ajax_url,e,function(e){var t;e.result&&"success"===e.result?((t=this.view.$el.find("form")).html(e.html),t=t.find(".woocommerce-exporter"),this.export_form=new o(t)):a.console.error(e.result),this.unblock(this.view.$el.find(".wc-backbone-modal-content"))}.bind(this))},block:function(e,t){e&&"undefined"!==e&&(t=s.extend({},{message:null,overlayCSS:{background:"#fff",opacity:.6}},t||{}),e.block(t))},unblock:function(e){e&&"undefined"!==e&&e.unblock()}};s.fn.wc_bis_notifications_export_form=function(){return new o(this),this}}(jQuery,window,document);