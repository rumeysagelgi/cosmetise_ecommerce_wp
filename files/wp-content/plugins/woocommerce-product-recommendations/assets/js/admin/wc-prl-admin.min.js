!function(g,w,y){function v(e,t,n){var s=this;if(e.length&&t.length){if(!(this instanceof v))return new v(e,t,n);this.templates=g.extend({row:"wc_prl_engine_%%type%%_filter_row",add:"wc_prl_engine_%%type%%_filter_add_content",row_content:"wc_prl_engine_%%type%%_filter_%%os_id%%_content"},n),this.os_add_templates={},this.os_row_templates={},this.os_row_content_templates={},this.$type_select=e,this.$data_container=1<t.length?t.first():t,this.$add_container=this.$data_container.find(".os_add"),this.$add_os_select=this.$data_container.find(".os_add select.os_type"),this.$list=this.$data_container.find("#os-list"),this.$boarding=this.$data_container.find(".os_boarding"),this.options_count=parseInt(this.$list.find(".os_row").length,10),this.$add_container.length&&this.$add_os_select.length&&this.$list.length&&(this.$list.prl_scripts(),this.$data_container.on("change_type",function(){var e=s.$type_select.val(),e=s.get_os_add_template(e)();s.$add_container.html("").append(e),s.reset_options(t)}),this.$data_container.on("mousedown",".os_remove .trash",function(){g(this).triggerHandler("mouseleave")}).on("click",".os_remove .trash",function(e){return e.preventDefault(),g(this).closest(".os_row").remove(),s.$data_container.trigger("os_remove"),s.options_count--,s.maybe_add_boarding(),!0}).on("change",".os_modifier select",function(){var e=g(this),n=e.val();$parent=e.closest(".os_row_inner"),($value_options=$parent.find(".os_value div[data-modifiers]")).length&&($value_options.hide(),$value_options.each(function(){var e=g(this),t=e.data("modifiers").split(",");t&&-1!==t.indexOf(n)&&e.show()}))}).on("change",".os_add select.os_type",function(){var e,t,n,o=g(this),a=o.val(),i=s.$type_select.val();return"add"!==a&&(e=parseInt(s.$data_container.attr("data-os_count"),10)+1,t=s.$data_container.attr("data-os_post_name"),n=s.get_os_row_template(i),i=s.get_os_row_content_template(i,a),n&&i)&&(n=n({os_index:e,os_content:i({os_post_name:t,os_index:e})}),s.$data_container.attr("data-os_count",e),s.$list.append(n),(i=s.$list.find(".os_row").last()).find('.os_type option[value="'+a+'"]').prop("selected","selected"),s.$data_container.trigger("os_added"),i.prl_scripts(),s.options_count++,s.maybe_add_boarding(),o.find('option[value="add"]').prop("selected","selected")),!1}),this.$list.on("change","select.os_type",function(){var e=g(this),t=e.val(),e=e.closest(".os_row"),n=s.$data_container.attr("data-os_post_name"),o=e.data("os_index"),a=s.$type_select.val(),a=s.get_os_row_content_template(a,t);return a&&(t=a({os_post_name:n,os_index:o}),e.find(".os_content").html(t),s.$data_container.trigger("os_changed"),e.prl_scripts()),!1}).on("click",".os_select_all",function(){return g(this).closest(".select-field").find("> select option").prop("selected","selected"),g(this).closest(".select-field").find("> select").trigger("change"),!1}).on("click",".os_select_none",function(){return g(this).closest(".select-field").find("> select option").removeAttr("selected"),g(this).closest(".select-field").find("> select").trigger("change"),!1}))}}g.fn.prl_scripts=function(){var e=g(this);e.sw_select2(),e.sw_enhanced_weight(),e.sw_enhanced_attribute(),e.find(".woocommerce-help-tip, .help_tip, .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},g.fn.maybe_disable_weight_selector=function(){var e=g(this).find(".os_row");2===e.length?e.first().find(".sw-enhanced-weight").addClass("disabled"):e.find(".sw-enhanced-weight").removeClass("disabled")},g.fn.sw_enhanced_weight=function(){var e=g(this).find(".sw-enhanced-weight");e.length&&e.each(function(){var e=g(this),t=e.find(".points"),n=e.find("span"),o=t.find("input"),a=parseInt(o.val(),10);o&&(t=e.find(".dec"),e=e.find(".inc"),t.on("click",function(){1<a&&(a-=1,n.each(function(e){e+1<=a?g(this).addClass("active"):g(this).removeClass("active")})),o.val(a)}),e.on("click",function(){a<5&&(a+=1,n.each(function(e){e+1<=a?g(this).addClass("active"):g(this).removeClass("active")})),o.val(a)}))})},g.fn.sw_enhanced_attribute=function(){var o,e=g(this).find(".os_value--attribute");e.length&&(o={message:null,overlayCSS:{background:"#fff",opacity:.6,borderRadius:"4px"}},e.each(function(){var e=g(this),t=e.closest(".os_row"),n=t.find(".os_value--attribute select.multiselect");e.find("select.prl_attribute_selector").val();e.on("change","select.prl_attribute_selector",function(){var e={action:"woocommerce_prl_json_get_attribute_terms",taxonomy:g(this).val(),security:wc_prl_admin_params.attributes_form_nonce};t.block(o),g.ajax({url:wc_prl_admin_params.wc_ajax_url,data:e,method:"GET",dataType:"json",success:function(e){n.children().remove(),n.selectSW({data:e}),t.unblock()},error:function(){alert(wc_prl_admin_params.i18n_attributes_form_session_expired),t.unblock()}})}).on("click",".os_value--tools .select_all",function(){var e=g(this).closest(".os_value");return e.find("select.multiselect option").prop("selected","selected"),e.find("select.multiselect").trigger("change"),!1}).on("click",".os_value--tools .select_none",function(){var e=g(this).closest(".os_value");return e.find("select.multiselect option").removeAttr("selected"),e.find("select.multiselect").trigger("change"),!1})}))},v.prototype={reset_options:function(){this.$list.html(""),this.$data_container.attr("data-filters_count",0),this.options_count=0,this.maybe_add_boarding()},get_os_row_template:function(e){var t,n=!1;return e=e.toLowerCase(),"function"==typeof this.os_row_templates[e]?n=this.os_row_templates[e]:(t=(t=this.templates.row).replace("%%type%%",e),n=wp.template(t),this.os_row_templates[e]=n),n},get_os_add_template:function(e){var t,n=!1;return e=e.toLowerCase(),"function"==typeof this.os_add_templates[e]?n=this.os_add_templates[e]:(t=(t=this.templates.add).replace("%%type%%",e),n=wp.template(t),this.os_add_templates[e]=n),n},get_os_row_content_template:function(e,t){var n,o=!1;return e=e.toLowerCase(),"object"==typeof this.os_row_content_templates[e]&&"function"==typeof this.os_row_content_templates[e][t]?o=this.os_row_content_templates[e][t]:(n=(n=(n=this.templates.row_content).replace("%%type%%",e)).replace("%%os_id%%",t),o=wp.template(n),void 0===this.os_row_content_templates[e]&&(this.os_row_content_templates[e]={}),this.os_row_content_templates[e][t]=o),o},maybe_add_boarding:function(){0==this.options_count?(this.$list.addClass("hidden"),this.$boarding.addClass("active"),this.$add_container.addClass("os_add--boarding")):(this.$list.removeClass("hidden"),this.$boarding.removeClass("active"),this.$add_container.removeClass("os_add--boarding"))}},g(function(){try{g(y.body).on("sw-select2-init",function(){g(".wc-engine-search").filter(":not(.enhanced)").each(function(){var t=g(this),n=t.closest(".sw-form-content").find("input.locations_type_select"),o=t.closest(".sw-form").find("#os-list"),e={allowClear:!!t.data("allow_clear"),placeholder:t.data("placeholder"),minimumInputLength:t.data("minimum_input_length")?t.data("minimum_input_length"):"3",escapeMarkup:function(e){return e},ajax:{url:wc_prl_admin_params.wc_ajax_url,dataType:"json",delay:250,data:function(e){return{term:e.term,action:t.data("action")||"woocommerce_prl_json_search_engines",security:wc_prl_admin_params.search_engine_nonce,exclude:t.data("exclude"),filter_type:t.data("filter_type"),include:t.data("include"),limit:t.data("limit"),display_stock:t.data("display_stock")}},processResults:function(e){var n=[];return e&&g.each(e,function(e,t){n.push({id:e,text:t.text,engine_type:t.type})}),{results:n}},cache:!0}};t.selectSW(e).addClass("enhanced").on("select2:selecting",function(e){if(n.length)return!(e.params.args.data.engine_type!==n.val()&&g.trim(o.html())&&!w.confirm(wc_prl_admin_params.i18n_change_type_conditions_warning))&&void 0}).on("select2:select",function(e){n.length&&(e=e.params.data).engine_type!==n.val()&&n.val(e.engine_type).trigger("change")})})}).trigger("sw-select2-init")}catch(e){w.console.log(e)}g("body.post-type-prl_engine.edit-php").length&&(g(".button-disabled").on("click",function(e){e.preventDefault(),e.stopPropagation()}),g(".wc-action-button-regenerate:not(.button-disabled)").on("click",function(e){e.preventDefault();e=g(this),e={action:"woocommerce_prl_regenerate_engine",engine_id:parseInt(e.attr("id"),10),security:wc_prl_admin_params.regenerate_engine_nonce};g.ajax({url:wc_prl_admin_params.wc_ajax_url,data:e,method:"POST",dataType:"json",complete:function(){},success:function(e){0<e.errors.length?w.alert(e.errors.join("\n\n")):w.alert(wc_prl_admin_params.i18n_engine_regeneration)},error:function(){w.alert(wc_prl_admin_params.i18n_toggle_session_expired)}})}));g("#wc-prl-engine-data").length&&(e={},r=g("#prl_engine_type"),s=g(".wc-prl-filters-container"),e.filters=new v(r,s,{row:"wc_prl_engine_%%type%%_filter_row",add:"wc_prl_engine_%%type%%_filter_add_content",row_content:"wc_prl_engine_%%type%%_filter_%%os_id%%_content"}),s=g(".wc-prl-amplifiers-container"),e.amplifiers=new v(r,s,{row:"wc_prl_engine_%%type%%_amplifier_row",add:"wc_prl_engine_%%type%%_amplifier_add_content",row_content:"wc_prl_engine_%%type%%_amplifier_%%os_id%%_content"}),e.amplifiers.$data_container.sw_enhanced_weight(),e.amplifiers.$data_container.maybe_disable_weight_selector(),e.amplifiers.$data_container.on("os_remove os_added os_changed",function(){g(this).maybe_disable_weight_selector()}),a=r.val(),s=g(".engine_type_assistant"),(i=!!s.length&&s.find(".engine_type_assistant__locations span"))&&i.length&&i.each(function(){var e=g(this);-1!==e.data("engine_type").indexOf(a)?e.fadeIn("fast"):e.hide()}),r.on("change",function(){var t=g(this).val();if(a===t)return!1;for(n in o=!0,e)if(g.trim(e[n].$list.html())){w.confirm(wc_prl_admin_params.i18n_change_type_warning)||(g(this).val(a),o=!1);break}if(o){for(n in a=t,e)e[n].$data_container.trigger("change_type");i&&i.length&&i.each(function(){var e=g(this);-1!==e.data("engine_type").indexOf(t)?e.fadeIn("fast"):e.hide()})}}));var e,n,o,a,i,t,s=g("#wc-prl-deploy-data"),r=(s.length&&(new v(r=g("#prl_engine_type"),g(".wc-prl-conditions-container"),{row:"wc_prl_engine_%%type%%_condition_row",add:"wc_prl_engine_%%type%%_condition_add_content",row_content:"wc_prl_engine_%%type%%_condition_%%os_id%%_content"}),s.find("#sw-button-primary").on("click",function(){var e=g(this);return setTimeout(function(){e.attr("disabled","true")},0),!0})),g(".quick-deploy__search"));r.length&&(t=r.data("action"),r.find("select").change(function(){var e=parseInt(g(this).val(),10);t=t.replace("%%engine_id%%",e),w.location=t}));g("#deployments-table").length&&(g(".wc-action-button.delete, .row-actions .delete").on("click",function(e){if(!w.confirm(wc_prl_admin_params.i18n_delete_deployment_warning))return e.preventDefault(),!1}),g(".wc-action-button-regenerate, .row-actions .regenerate a").on("click",function(e){e.preventDefault();e=g(this),e={action:"woocommerce_prl_regenerate_deployment",engine_id:parseInt(e.attr("id"),10),security:wc_prl_admin_params.regenerate_deployment_nonce};g.ajax({url:wc_prl_admin_params.wc_ajax_url,data:e,method:"POST",dataType:"json",complete:function(){},success:function(e){0<e.errors.length?w.alert(e.errors.join("\n\n")):w.alert(wc_prl_admin_params.i18n_deployment_regeneration)},error:function(){w.alert(wc_prl_admin_params.i18n_toggle_session_expired)}})}));var l,c,_,d,p,m,f,u,h,s=g(".wc-prl-deployments");s.length&&(l=g(".wc-metaboxes"),r=s.find(".toolbar"),c=s.find(".wc-prl-deployments__list__buttons"),_=s.find(".wc-prl-deployments__boarding"),d=r.find(".bulk_toggle_wrapper"),p=g(".wc-prl-hooks .wc-prl-hooks__tab--active .current_count"),m={row:"wc_prl_engine_%%type%%_condition_row",add:"wc_prl_engine_%%type%%_condition_add_content",row_content:"wc_prl_engine_%%type%%_condition_%%os_id%%_content"},l.find(".wc-metabox").each(function(){var e=g(this),t=e.find(".locations_type_select"),n=e.find(".wc-prl-conditions-container");t.on("change",function(){n.trigger("change_type")}),new v(t,n,m)}),r.on("click",".expand_all",function(){return l.find(".wc-metabox").each(function(){var e=g(this);e.find(".wc-metabox-content").show(),e.addClass("open").removeClass("closed")}),!1}).on("click",".close_all",function(){return l.find(".wc-metabox").each(function(){var e=g(this);e.find(".wc-metabox-content").hide(),e.addClass("closed").removeClass("open")}),!1}),s.on("click",".wc-metabox > h3",function(e){if("active-toggle"===e.target.id||"remove_row"===e.target.id)return!1;e=g(this);e.parent(".wc-metabox").toggleClass("closed").toggleClass("open"),e.next(".wc-metabox-content").stop().slideToggle(300)}).on("click","#remove_row",function(e){var t=g(this).closest(".wc-prl-deployments__row");if(!t.hasClass("wc-prl-deployments__row--added")&&!w.confirm(wc_prl_admin_params.i18n_delete_deployment_warning))return e.preventDefault(),!1;e=t.data("deployment_id"),l.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e={action:"wc_prl_delete_deployment",deployment_id:e,security:wc_prl_admin_params.delete_deployment_nonce};g.ajax({url:wc_prl_admin_params.wc_ajax_url,data:e,method:"POST",dataType:"json",complete:function(){l.unblock()},success:function(e){0<e.errors.length?w.alert(e.errors.join("\n\n")):(t.remove(),f(),u(!1),($last_deployment=l.find(".wc-prl-deployments__row").last()).length||(_.removeClass("wc-prl-deployments__boarding--hidden"),c.addClass("wc-prl-deployments__list__buttons--empty")))},error:function(){w.alert(wc_prl_admin_params.i18n_toggle_session_expired)}})}).on("click","#active-toggle",function(){var t=g(this),n=t.closest(".wc-metabox").find(".wc-metabox-content > input.form_active"),e=t.closest(".wc-prl-deployments__row"),o=e.data("deployment_id");return-1<e[0].className.indexOf("wc-prl-deployments__row--added")?h(t,n):(t.addClass("woocommerce-input-toggle--loading"),e={action:"wc_prl_toggle_deployment",value:n.val(),deployment_id:o,security:wc_prl_admin_params.toggle_deployment_nonce},g.ajax({url:wc_prl_admin_params.wc_ajax_url,data:e,method:"POST",dataType:"json",complete:function(){t.removeClass("woocommerce-input-toggle--loading")},success:function(e){0<e.errors.length?w.alert(e.errors.join("\n\n")):h(t,n)},error:function(){w.alert(wc_prl_admin_params.i18n_toggle_session_expired)}})),!1}).on("click","button.wc-prl-deployments__add",function(e){e.preventDefault();var e=l.data("filter_type"),t=l.find(".wc-prl-deployments__row").last(),t=t.length?(n=parseInt(t.find("input.form_index").val(),10)+1,parseInt(t.attr("data-index"),10)):n=0,n=(l.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),{action:"wc_prl_add_deployment",form_index:n,index:t,filter_type:e,security:wc_prl_admin_params.add_deployment_nonce});g.ajax({url:wc_prl_admin_params.wc_ajax_url,data:n,method:"POST",dataType:"json",complete:function(){l.unblock()},success:function(e){var t,n;0<e.errors.length?w.alert(e.errors.join("\n\n")):(t=g(e.markup),_.hasClass("wc-prl-deployments__boarding--hidden")||(_.addClass("wc-prl-deployments__boarding--hidden"),c.removeClass("wc-prl-deployments__list__buttons--empty")),l.append(t),t.prl_scripts(),e=t.find(".locations_type_select"),n=t.find(".wc-prl-conditions-container"),t.find(".wc-engine-search").one("change",function(){t.find(".sw-form").removeClass("sw-form--no-engine")}),e.on("change",function(){n.trigger("change_type")}),new v(e,n,m),u(!0))},error:function(){w.alert(wc_prl_admin_params.i18n_toggle_session_expired)}})}),l.on("keyup","input.form_deployment_title",function(){var e=g(this);e.closest(".wc-metabox").find("h3 .deployment_title_inner").text(e.val())}),l.sortable({items:".wc-prl-deployments__row",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),f()}}),f=function(){l.find(".wc-prl-deployments__row").each(function(e,t){e+=1;g(t).attr("data-index",e),g(".form_display_order",t).val(e),g(".deployment_title_index",t).html(e)})},u=function(e){var t=parseInt(p.html(),10);!0===e?t++:t--,0<t?d.removeClass("disabled"):d.addClass("disabled"),p.html(t)},h=function(e,t){"on"===t.val()?(t.val("off"),e.removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled")):(t.val("on"),e.removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"))})})}(jQuery,window,document);